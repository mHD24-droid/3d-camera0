<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø¹Ø±Ø¶ AR Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; color: white; font-family: sans-serif; }
    video { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: -1; }
    canvas { position: fixed; top: 0; left: 0; z-index: 1; }
    #ui { position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%); z-index: 10; display: flex; gap: 10px; }
    button { background: rgba(0,0,0,0.7); color: white; border: none; padding: 10px 20px; border-radius: 10px; font-size: 16px; cursor: pointer; }
    #log { position: fixed; top: 10px; left: 10px; font-size: 14px; background: rgba(0,0,0,0.6); padding: 6px 10px; border-radius: 6px; z-index: 20; }
  </style>

  <!-- Three.js + GLTFLoader -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
  <video id="camera" autoplay playsinline></video>
  <div id="log">Ø¬Ø§Ø±Ù ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</div>

  <div id="ui">
    <button id="addModel" disabled>Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬</button>
  </div>

  <script>
    const log = msg => document.getElementById("log").innerText = msg;
    const video = document.getElementById("camera");
    const addModelButton = document.getElementById("addModel");

    let scene, camera, renderer, model;
    let modelReady = false;

    // 1ï¸âƒ£ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
        video.srcObject = stream;
        log("âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø¯Ø£Øª");
        initThree();
      } catch (err) {
        console.warn("ÙØ´Ù„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©:", err);
        try {
          const stream2 = await navigator.mediaDevices.getUserMedia({ video: true });
          video.srcObject = stream2;
          log("âš ï¸ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©");
          initThree();
        } catch (err2) {
          console.error("Camera error:", err2);
          log("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + (err2?.name || err2?.message || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
        }
      }
    }

    startCamera();

    // 2ï¸âƒ£ Ø¥Ø¹Ø¯Ø§Ø¯ Three.js
    function initThree() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 100);
      camera.position.set(0, 0, 2);

      renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setClearColor(0x000000, 0); // Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ©
      document.body.appendChild(renderer.domElement);

      const light = new THREE.HemisphereLight(0xffffff, 0x444444, 1.5);
      scene.add(light);

      loadModel();
      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    // 3ï¸âƒ£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function loadModel() {
      log("â³ Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬...");
      const loader = new THREE.GLTFLoader();
      loader.load(
        "https://modelviewer.dev/shared-assets/models/Astronaut.glb",
        gltf => {
          model = gltf.scene;
          model.scale.set(0.5, 0.5, 0.5);
          model.position.set(0, -1, -3);
          modelReady = true;
          addModelButton.disabled = false;
          log("âœ… Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø§Ù‡Ø². Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØªÙ‡!");
        },
        xhr => {
          const percent = xhr.total ? Math.round((xhr.loaded / xhr.total) * 100) : "??";
          log(`â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬... ${percent}%`);
        },
        err => {
          console.error("Ø®Ø·Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:", err);
          log("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.");
        }
      );
    }

    // 4ï¸âƒ£ Ø­Ù„Ù‚Ø© Ø§Ù„ØªØ­Ø±ÙŠÙƒ
    function animate() {
      requestAnimationFrame(animate);
      if (model && model.parent === scene) {
        model.rotation.y += 0.01;
      }
      renderer.render(scene, camera);
    }

    // 5ï¸âƒ£ Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© / Ø§Ù„Ø¥Ø²Ø§Ù„Ø©
    addModelButton.addEventListener("click", () => {
      if (!modelReady) return;
      if (model.parent === scene) {
        scene.remove(model);
        addModelButton.innerText = "Ø¥Ø¶Ø§ÙØ© Ù†Ù…ÙˆØ°Ø¬";
        log("ğŸ—‘ï¸ ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬");
      } else {
        scene.add(model);
        addModelButton.innerText = "Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬";
        log("ğŸš€ ØªÙ… ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙÙŠ Ø§Ù„Ù…Ø´Ù‡Ø¯!");
      }
    });
  </script>
</body>
</html>

